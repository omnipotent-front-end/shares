<!doctype html><html><head><meta charset=UTF-8><title>Node工具化 - By 刘放</title><link rel=stylesheet href=https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdn.staticfile.org/prism/1.15.0/themes/prism.min.css><link rel=stylesheet href=https://cdn.staticfile.org/KaTeX/0.10.0-rc.1/katex.min.css><link href=./css/chunk-vendors.4e4765ff.css rel=stylesheet></head><body><div><article id=webslides><section slide class="slide bg-black-blue aligncenter" image="http://edu-image.nosdn.127.net/bbe5be1eda96418aaa409495f8b76a00.png?imageView&quality=100 .dark"><span class="background dark" style="background-image:url('http://edu-image.nosdn.127.net/bbe5be1eda96418aaa409495f8b76a00.png?imageView&quality=100')"></span><div class=wrap wrap=true><h1 class="text-landing text-shadow">node工具化对前端开发提效的实践</h1></div></section><section slide class=slide :class="size-30 aligncenter"><div class="wrap size-30 aligncenter" wrap=true><h2>自我介绍</h2><hr><ul><li class="animated fadeInUp">Name 刘放</li><li class="animated fadeInUp delay-400">Web前端开发@有道云课堂</li><li class="animated fadeInUp delay-800">Github brizer</li><li class="animated fadeInUp delay-1200">Wechat brizer1992</li></ul></div></section><section slide class=slide><div class=wrap wrap=true><div class=content-left><h3>分享大纲</h3><ul class="specs flexblock"><li><div><h2>Node背景介绍</h2></div></li><li><div><h2>脚手架</h2></div></li><li><div><h2>多工程管理</h2></div></li><li><div><h2>Mock</h2></div></li><li><div><h2>活动页面生成系统</h2></div></li></ul></div></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>Node背景介绍</h2></div></section><section slide class="slide aligncenter"><div class=wrap wrap=true><h2>Node到底是什么？</h2><p class="lightSpeedIn animated slow">Node.js® is a JavaScript runtime built on Chrome's V8 JavaScript engine.</p></div></section><section slide class=slide image="http://edu-image.nosdn.127.net/743a89b32a714af58455114b02d73508.jpg?imageView&quality=100 .right"><span class=background-right style="background-image:url('http://edu-image.nosdn.127.net/743a89b32a714af58455114b02d73508.jpg?imageView&quality=100')"></span><div class=wrap wrap=true><div class=content-left><h3>Node的组成</h3><ul class="specs flexblock"><li><div><h2>Application</h2><p>你写的node应用或者说模块</p></div></li><li><div><h2>Modules</h2><p>Node.js 标准库，对外提供的 JavaScript 接口，例如模块 http、buffer、fs、stream 等</p></div></li><li><div><h2>C++ Binding</h2><p>JavaScript 与 C++ 连接的桥梁，对下层模块进行封装，向上层提供基础的 API 接口如zlib、OpenSSL、c-ares、http-parser 等</p></div></li><li><div><h2>Addons</h2><p>JavaScript 与 C++ 连接的桥梁，第三方胶水层代码</p></div></li></ul></div></div></section><section slide class=slide image="http://edu-image.nosdn.127.net/743a89b32a714af58455114b02d73508.jpg?imageView&quality=100 .right"><span class=background-right style="background-image:url('http://edu-image.nosdn.127.net/743a89b32a714af58455114b02d73508.jpg?imageView&quality=100')"></span><div class=wrap wrap=true><div class=content-left><h3>Node的组成</h3><ul class="specs flexblock"><li><div><h2>V8</h2><p>Google 开源的高性能 JavaScript 引擎，以 C++ 实现。这也是集成在 Chrome 中的 JS 引擎</p></div></li><li><div><h2>libuv</h2><p>提供异步功能的 C 库。它在运行时负责一个事件循环（Event Loop）、一个线程池、文件系统 I/O、DNS 相关和网络 I/O，以及一些其他重要功能。 每个操作系统对于事件多路复用器有其自身的接口，Linux是epoll，Mac OSX是kqueue，Windows的IOCP API</p></div></li></ul></div></div></section><section slide class=slide><div class=wrap wrap=true><h2>Node的应用场景</h2><ul class=description><li><span class=text-label>跨平台:</span> 传统的PC Web端，以及PC客户端 nw.js/electron 、移动端 cordova、HTML5、react-native、weex，硬件 ruff.io...</li><li><span class=text-label>后端应用开发:</span> 网站、Api、RPC服务，比如Express/Koa/Egg/Nest/Hapi/Restify/Socket.io...</li><li><span class=text-label>前端基建:</span> 三大框架 React/Vue/Angular 辅助开发，以及工程化演进如grunt/gulp/webpack/rollup/parcel/snowpack/rollup...</li><li><span class=text-label>命令行工具:</span> npm上各种模块如commander/yargs/shelljs/lerna/http-server/node-http-proxy...</li></ul></div></section><section slide class="slide fullscreen"><div class=wrap wrap=true><div class="card-50 bg-white"><figure><img src="http://edu-image.nosdn.127.net/74f66c2ae7c54e8dbadba9cbfe566c7b.jpg?imageView&amp;quality=100" alt=""></figure><div class=flex-content><h2>Node的生态优势</h2><p>数据源引自<a href=http://www.modulecounts.com/ class=text-intro target=_blank>modulecounts</a></p><p>更多Node使用场景及生态请参考</p><p><a href=https://github.com/sindresorhus/awesome-nodejs class=text-intro target=_blank>awesome-node</a></p><p><a href=https://brizer.github.io/urls/zh/node_modules_zh.html class=text-intro target=_blank>awesome-url</a></p></div></div></div></section><section slide class=slide><div class=wrap wrap=true><div class=content-left><h3>分享大纲</h3><ul class="specs flexblock"><li><div><h2>Node背景介绍</h2></div></li><li><div><h2>脚手架</h2></div></li><li><div><h2>多工程管理</h2></div></li><li><div><h2>Mock</h2></div></li><li><div><h2>活动页面生成系统</h2></div></li></ul></div></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>脚手架</h2></div></section><section slide class=slide image="http://edu-image.nosdn.127.net/0f9dfc5e2c594eda96bad2a0d1cb3b5c.jpg?imageView&quality=100 .right"><span class=background-right style="background-image:url('http://edu-image.nosdn.127.net/0f9dfc5e2c594eda96bad2a0d1cb3b5c.jpg?imageView&quality=100')"></span><div class=wrap wrap=true><div class=content-left><h3>一个标准的脚手架思路</h3><ul><li><span class=text-label>命令注册:</span> commander/yargs...</li><li><span class=text-label>git拉取:</span> download-git-repo/@gitbeaker...</li><li><span class=text-label>交互:</span> inquirer/ora...</li><li><span class=text-label>模板:</span> Handlebars/EJS/Jade...</li></ul></div></div></section><section slide class=slide :class="aligncenter size-50"><div class="wrap aligncenter size-50" wrap=true><h2>从头自建脚手架</h2><hr><ul><li>重复造轮子！</li><li>劳民伤财！</li><li>稳定性不可保障，维护成本高</li><li>耦合设计，拓展性不高</li></ul></div></section><section slide class="slide bg-white aligncenter" image="http://edu-image.nosdn.127.net/53c9e1ec8c1744d9afd0e8b55a597783.jpg?imageView&quality=100 .dark"><span class="background dark" style="background-image:url('http://edu-image.nosdn.127.net/53c9e1ec8c1744d9afd0e8b55a597783.jpg?imageView&quality=100')"></span><div class=wrap wrap=true><h2>合理利用生态优势，拥抱开源</h2><table><thead><tr><th style=text-align:center>库</th><th style=text-align:center>使用场景</th><th style=text-align:center>定制方式</th></tr></thead><tbody><tr><td style=text-align:center>yeoman</td><td style=text-align:center>初始化工程</td><td style=text-align:center>定制化generator，插件使用</td></tr><tr><td style=text-align:center>plop</td><td style=text-align:center>工程内新增或修改文件</td><td style=text-align:center>定制交互prompts及操作actions</td></tr></tbody></table></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>脚手架1.0</h2><p>基于plop，工程内定制</p></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h3>工程内置模板及配置</h3><p><img src="http://edu-image.nosdn.127.net/6fa5409566a54906857f834086cf49a1.jpg?imageView&amp;quality=100" alt=img></p></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h3>自定义交互及行为</h3><pre class=language-javascript><code class=language-javascript>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    prompts<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token comment">//...各种不同类型的交互</span>
            type<span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span>
            message<span class="token operator">:</span> <span class="token string">"请选择新增的页面位于哪个一级路由下:"</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">"scope"</span><span class="token punctuation">,</span>
            choices<span class="token operator">:</span> pageList
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
            type<span class="token operator">:</span> <span class="token string">"input"</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">"chineseName"</span><span class="token punctuation">,</span>
            message<span class="token operator">:</span> <span class="token string">"请输入页面中文名称（例如开屏配置）:"</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function-variable function">actions</span><span class="token operator">:</span> <span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token comment">//获取交互中的得到的参数</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> scope<span class="token punctuation">,</span> name<span class="token punctuation">,</span> chineseName <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token comment">//...各种不同类型的行为</span>
                type<span class="token operator">:</span> <span class="token string">"add"</span><span class="token punctuation">,</span>
                path<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">src/javascript/admin/module/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scope<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
                templateFile<span class="token operator">:</span> <span class="token string">"plop-templates/page/module.hbs"</span><span class="token punctuation">,</span>
                data<span class="token operator">:</span> <span class="token punctuation">{</span>umiName<span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                type<span class="token operator">:</span> <span class="token string">"modify"</span><span class="token punctuation">,</span>
                path<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">src/javascript/admin/config/admin.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
                templateFile<span class="token operator">:</span> <span class="token string">"plop-templates/page/config.hbs"</span><span class="token punctuation">,</span>
                pattern<span class="token operator">:</span> <span class="token regex">/var exports = \{/</span><span class="token punctuation">,</span>
                data<span class="token operator">:</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h3>效果展示</h3><p><img src="http://edu-image.nosdn.127.net/33b04d8c801e4782b9062bef0da37db7.gif?imageView&amp;quality=100" alt=img></p></div></section><section slide class=slide :class=size-60><div class="wrap size-60" wrap=true><h3>遗留问题</h3><hr><div class="bg-white shadow"><ul class="flexblock reasons"><li><h2>模板在工程内维护，那么跨工程的通用模板不好复用</h2></li><li><h2>每次新增都需要改到配置文件，可维护性不怎么好</h2></li></ul></div></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>脚手架2.0</h2><p>基于node-plop，分离模板库和脚手架</p></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>整体思路</h2><p><img src="http://edu-image.nosdn.127.net/dbd9249f0f9f4b4ab1cf29ba131f59b2.jpg?imageView&amp;quality=100" alt=""></p></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>物料库风格</h2><pre class=language-textile><code class=language-textile><span class="token phrase">├── blocks - 各个物料本身的模板
<span class="token table"><span class="token punctuation">|</span>  ├── bower
<span class="token punctuation">|</span>  <span class="token punctuation">|</span>  ├── bower.hbs
<span class="token punctuation">|</span>  <span class="token punctuation">|</span>  └── bowerrc.hbs
<span class="token punctuation">|</span>  ├── example
<span class="token punctuation">|</span>  <span class="token punctuation">|</span>  └── demo.hbs
<span class="token punctuation">|</span>  ├── mocker
<span class="token punctuation">|</span>  <span class="token punctuation">|</span>  ├── dev.hbs
<span class="token punctuation">|</span>  <span class="token punctuation">|</span>  ├── httpmockrc.hbs
<span class="token punctuation">|</span>  <span class="token punctuation">|</span>  └── package.hbs
<span class="token punctuation">|</span>  ├── roll
<span class="token punctuation">|</span>  <span class="token punctuation">|</span>  ├── dev.hbs
<span class="token punctuation">|</span>  <span class="token punctuation">|</span>  └── package.hbs
<span class="token punctuation">|</span>  └── singleVue
<span class="token punctuation">|</span></span>     └── index.hbs
└── plop<span class="token inline"><span class="token punctuation">-</span><span class="token deleted">templates </span><span class="token punctuation">-</span></span> 各个物料自己的命令行交互及具体文件流操作
   ├── bowerGenerator.js
   ├── exampleGenerator.js
   ├── mockerGenerator.js
   ├── rollGenerator.js
   └── singleVueGenerator.js</span>

</code></pre></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h3>遗留问题（todo）</h3><hr><div class="bg-white shadow"><ul class="flexblock reasons"><li><h2>物料不能做到本地开发，调试不便（打算通过cli强化物料开发流程）</h2></li><li><h2>工程内需要到指定文件路径执行命令（打算通过vscode扩展或直接配上ui解决）</h2></li></ul></div></div></section><section slide class=slide><div class=wrap wrap=true><div class=content-left><h3>分享大纲</h3><ul class="specs flexblock"><li><div><h2>Node背景介绍</h2></div></li><li><div><h2>脚手架</h2></div></li><li><div><h2>多工程管理</h2></div></li><li><div><h2>Mock</h2></div></li><li><div><h2>活动页面生成系统</h2></div></li></ul></div></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>多工程管理</h2></div></section><section slide class="slide aligncenter"><div class=wrap wrap=true><h2>工程数量</h2><p class=text-data>10+</p><h2>组件数量</h2><p class=text-data>60+</p></div></section><section slide class="slide bg-white aligncenter" image="http://edu-image.nosdn.127.net/381e4d34c4c34f1b89499ddecbabe6df.png?imageView&quality=100 .dark"><span class="background dark" style="background-image:url('http://edu-image.nosdn.127.net/381e4d34c4c34f1b89499ddecbabe6df.png?imageView&quality=100')"></span><div class=wrap wrap=true><h2>WTF</h2><h3>每次预发上线都头大？</h3></div></section><section slide class=slide><div class=wrap wrap=true><h2>合理利用生态优势，拥抱开源</h2><table><thead><tr><th style=text-align:center>库</th><th style=text-align:center>特点</th><th style=text-align:center>特点</th><th style=text-align:center>场景</th></tr></thead><tbody><tr><td style=text-align:center>lerna</td><td style=text-align:center>mono-repo</td><td style=text-align:center>同一git仓库下，管理多个包，包含开发及发布完整流程</td><td style=text-align:center>util库及组件库</td></tr><tr><td style=text-align:center>meta</td><td style=text-align:center>multi-repo</td><td style=text-align:center>同一文件结构下，管理多个不同仓库，支持插件扩展子命令，管理git等</td><td style=text-align:center>工程群</td></tr><tr><td style=text-align:center>multi-repo-git</td><td style=text-align:center>multi-repo</td><td style=text-align:center>通过全局配置文件，跨文件目录管理不同仓库，定制化git及包依赖，不支持插件</td><td style=text-align:center>工程群</td></tr></tbody></table></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h3>效果展示</h3><p><img src="http://edu-image.nosdn.127.net/b12dddc6276f46b5a355550e2317ac90.gif?imageView&amp;quality=100" alt=img></p></div></section><section slide class=slide :class="size-40 aligncenter"><div class="wrap size-40 aligncenter" wrap=true><h3>核心原理</h3><hr><pre class=language-js><code class=language-js><span class="token comment">//透传参数，子进程指定路径执行</span>
child_process<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span><span class="token punctuation">{</span>
    cwd<span class="token operator">:</span><span class="token string">'配置文件读取的工程路径'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></section><section slide class=slide><div class=wrap wrap=true><div class=content-left><h3>分享大纲</h3><ul class="specs flexblock"><li><div><h2>Node背景介绍</h2></div></li><li><div><h2>脚手架</h2></div></li><li><div><h2>多工程管理</h2></div></li><li><div><h2>Mock</h2></div></li><li><div><h2>活动页面生成系统</h2></div></li></ul></div></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>Mock</h2></div></section><section slide class=slide :class="aligncenter size-50"><div class="wrap aligncenter size-50" wrap=true><h2>哪些场景需要Mock</h2><hr><ul><li>前端本地开发时，对依赖的后端接口的Mock</li><li>服务A开发时，对依赖的服务B的Mock</li><li>单元测试时，对某些模块或方法的Mock</li></ul></div></section><section slide class="slide bg-white aligncenter" image="http://edu-image.nosdn.127.net/4c56650f90ca4dd48eeed55fc226cefd.jpg?imageView&quality=100 .dark"><span class="background dark" style="background-image:url('http://edu-image.nosdn.127.net/4c56650f90ca4dd48eeed55fc226cefd.jpg?imageView&quality=100')"></span><div class=wrap wrap=true><h2>接口Mock选型</h2><table><thead><tr><th style=text-align:center>库</th><th style=text-align:center>特点描述</th><th style=text-align:center>使用场景</th></tr></thead><tbody><tr><td style=text-align:center>yapi</td><td style=text-align:center>重型平台，功能齐全</td><td style=text-align:center>统一管理所有工程接口</td></tr><tr><td style=text-align:center>rap2-delos</td><td style=text-align:center>重型平台，阿里妈妈出品</td><td style=text-align:center>统一管理所有工程接口</td></tr><tr><td style=text-align:center>nei</td><td style=text-align:center>重型平台，网易自研</td><td style=text-align:center>统一管理所有工程接口</td></tr><tr><td style=text-align:center>http-mocker</td><td style=text-align:center>笔者自研，轻量级</td><td style=text-align:center>组件内或util等example对应mock</td></tr></tbody></table></div></section><section slide class="slide aligncenter"><div class=wrap wrap=true><h2>轻量级场景</h2><h4>你是直接代码侵入式修改mock？</h4><pre class=language-js><code class=language-js><span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
    save<span class="token operator">:</span> isLocal<span class="token operator">?</span> <span class="token string">'/mock/success.json'</span><span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/p/train/config/submit.do?courseId=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>g<span class="token punctuation">.</span>courseId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    detail<span class="token operator">:</span> <span class="token punctuation">(</span>isLocal<span class="token operator">?</span><span class="token string">'/mock'</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/j/train/config/init.json'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">save</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">:</span>Promise<span class="token operator">&lt;</span>boolean<span class="token operator">></span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token keyword">return</span> baseSvs<span class="token punctuation">[</span>isLocal<span class="token operator">?</span><span class="token string">'get'</span><span class="token operator">:</span><span class="token string">'post'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>save<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">detail</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token operator">:</span>Promise<span class="token operator">&lt;</span>any<span class="token operator">></span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> baseSvs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>detail<span class="token operator">+</span><span class="token string">'?courseId='</span><span class="token operator">+</span>courseId<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre></div></section><section slide class="slide aligncenter"><div class=wrap wrap=true><h4>还是启动一个mock服务，来响应所有接口？</h4><pre class=language-js><code class=language-js><span class="token keyword">import</span> Mock <span class="token keyword">from</span> <span class="token string">'mockjs'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>
  <span class="token comment">// mock get all routes form server</span>
  <span class="token punctuation">{</span>
    url<span class="token operator">:</span> <span class="token string">'/article/pv'</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">response</span><span class="token operator">:</span> <span class="token parameter">_</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        code<span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span>
          pvData<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'PC'</span><span class="token punctuation">,</span> pv<span class="token operator">:</span> <span class="token number">1024</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'mobile'</span><span class="token punctuation">,</span> pv<span class="token operator">:</span> <span class="token number">1024</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'ios'</span><span class="token punctuation">,</span> pv<span class="token operator">:</span> <span class="token number">1024</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'android'</span><span class="token punctuation">,</span> pv<span class="token operator">:</span> <span class="token number">1024</span> <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div></section><section slide class=slide :class="aligncenter size-50"><div class="wrap aligncenter size-50" wrap=true><ul><li><p>侵入代码影响性能和可读性！</p></li><li><p>额外启动一个服务很繁琐！</p></li><li><p>无法动态切换某一个接口本地和远程模式！</p></li><li><p>每个规则都需要手写js，麻烦！</p></li></ul></div></section><section slide class="slide aligncenter size-60"><div class=wrap wrap=true><h2>解决方案 Http-mocker</h2><h4>如何不启动服务、不侵入也可以进行mock?</h4><p>直接将express或webpack-dev-server的app对象传入</p><pre class=language-js><code class=language-js><span class="token keyword">const</span> <span class="token punctuation">{</span> mocker <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http-mockjs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">before</span><span class="token operator">:</span><span class="token parameter">app</span><span class="token operator">=></span><span class="token punctuation">{</span>
      <span class="token function">mocker</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></section><section slide class="slide aligncenter size-60"><div class=wrap wrap=true><h4>如何识别路由，并动态切换本地或远程?</h4><p>利用<code>app.all('/*')</code>，以<code>path-to-regexp</code>风格拦截路由</p><pre class=language-js><code class=language-js>  app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">"/*"</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> proxyMatch <span class="token operator">=</span> <span class="token function">getMatechedRoute</span><span class="token punctuation">(</span>proxyLists<span class="token punctuation">,</span> proxyURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 匹配到对应路由</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>proxyMatch <span class="token operator">&amp;&amp;</span> proxyMatch<span class="token punctuation">.</span>ignore <span class="token operator">!==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token operator">/</span><span class="token operator">/</span> 延时返回功能
      <span class="token keyword">if</span><span class="token punctuation">(</span>proxyMatch<span class="token punctuation">.</span>delay <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> proxyMatch<span class="token punctuation">.</span>delay <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span>proxyMatch<span class="token punctuation">.</span>delay<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">/</span> 校验入参格式
      <span class="token keyword">if</span><span class="token punctuation">(</span>proxyMatch<span class="token punctuation">.</span>validate <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isEmptyObject</span><span class="token punctuation">(</span>proxyMatch<span class="token punctuation">.</span>validate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token operator">/</span><span class="token operator">/</span><span class="token operator">...</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">let</span> responseBody<span class="token punctuation">;</span>
      <span class="token operator">/</span><span class="token operator">/</span> 同时支持js模式，沙盒运行
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex">/js$/ig</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        responseBody <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>jsContent<span class="token punctuation">)</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token operator">/</span><span class="token operator">/</span> json模式直接读取返回值
        responseBody <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>curPath<span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">/</span> 支持mockjs来灵活化数据
      <span class="token keyword">const</span> result <span class="token operator">=</span> mock<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span>responseBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">/</span><span class="token operator">/</span> 自定义响应头 
      res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>responseHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section><section slide class="slide bg-black slide-top" image="http://edu-image.nosdn.127.net/f4b0ed19008d459cb48420c3ef848319.jpg?imageView&quality=100"><span class=background style="background-image:url('http://edu-image.nosdn.127.net/f4b0ed19008d459cb48420c3ef848319.jpg?imageView&quality=100')"></span><div class=wrap wrap=true><div class=content-center><h4>如何优化配置的便利性?</h4><p>抽出独立的ui包，可视化编辑</p></div></div></section><section slide class=slide><div class=wrap wrap=true><div class=content-left><h3>分享大纲</h3><ul class="specs flexblock"><li><div><h2>Node背景介绍</h2></div></li><li><div><h2>脚手架</h2></div></li><li><div><h2>多工程管理</h2></div></li><li><div><h2>Mock</h2></div></li><li><div><h2>活动页面生成系统</h2></div></li></ul></div></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>活动页面生成系统</h2></div></section><section slide class="slide fullscreen"><div class=wrap wrap=true><div class="card-50 bg-white"><figure><img src="http://edu-image.nosdn.127.net/85613f39d38844ff889a45bb97811adb.jpg?imageView&amp;quality=100" alt=""></figure><div class=flex-content><p class=text-intro>没有开发介入的情况下，运营自己完成页面的整体搭建</p><p>应用场景:</p><ul><li>促销活动页，<a href=https://study.163.com/topics/2020xxj#/ class=text-intro target=_blank>云课堂618大促为例</a></li></ul></div></div></div></section><section slide class="slide bg-black aligncenter" image="http://edu-image.nosdn.127.net/6972ae45a8dd470ca8bd40ce9d578b59.jpg?imageView&quality=100 .dark"><span class="background dark" style="background-image:url('http://edu-image.nosdn.127.net/6972ae45a8dd470ca8bd40ce9d578b59.jpg?imageView&quality=100')"></span><div class=wrap wrap=true><h2>完成页面数量</h2><p class=text-data>9700+</p><h2>独立模块数量</h2><p class=text-data>120+</p></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h3>整体架构</h3><p><img src="http://edu-image.nosdn.127.net/0c3530ef6c824a5aa0da71ce03d43030.jpg?imageView&amp;quality=100" alt=""></p></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h3>模块元数据</h3><pre class=language-json><code class=language-json><span class="token punctuation">{</span>
    <span class="token property">"chineseName"</span><span class="token operator">:</span> <span class="token string">"移动端课程卡片带切换(抢课,拼团,提醒,收藏)"</span><span class="token punctuation">,</span>
    <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"&lt;ux-cms-course-list-with-tab tabList={list}>&lt;/ux-cms-course-list-with-tab>"</span><span class="token punctuation">,</span>
    <span class="token property">"dataTemplate"</span><span class="token operator">:</span> <span class="token string">"c2_courselist_tab"</span><span class="token punctuation">,</span>
    <span class="token property">"dependence"</span><span class="token operator">:</span> <span class="token string">"pool/component-cms/src/course-list-with-tab/wap/ui"</span><span class="token punctuation">,</span>
    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"移动端课程卡片带切换(抢课,拼团,提醒,收藏)"</span><span class="token punctuation">,</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"m_course_list_with_tab_all_m"</span><span class="token punctuation">,</span>
    <span class="token property">"previewImg"</span><span class="token operator">:</span> <span class="token string">"http://edu-image.nosdn.127.net/367ae591-32f3-4337-a195-cafd5543082e.png"</span><span class="token punctuation">,</span>
    <span class="token property">"style"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">"viewType"</span><span class="token operator">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span>
</code></pre></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h3>数据元数据</h3><pre class=language-json><code class=language-json><span class="token punctuation">{</span>
  <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token string">"c2_voteList"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span> <span class="token operator">:</span> <span class="token string">"投票列表模板"</span><span class="token punctuation">,</span>
  <span class="token property">"items"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"description"</span> <span class="token operator">:</span> <span class="token string">"投票列表类型,10为机构,20为讲师"</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"Number"</span><span class="token punctuation">,</span>
      <span class="token property">"propertyName"</span> <span class="token operator">:</span> <span class="token string">"id"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token property">"description"</span> <span class="token operator">:</span> <span class="token string">"一页数量"</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"Number"</span><span class="token punctuation">,</span>
      <span class="token property">"propertyName"</span> <span class="token operator">:</span> <span class="token string">"nums"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token property">"description"</span> <span class="token operator">:</span> <span class="token string">"投票结束时间"</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"Time"</span><span class="token punctuation">,</span>
      <span class="token property">"propertyName"</span> <span class="token operator">:</span> <span class="token string">"endTime"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div></section><section slide class="slide bg-black aligncenter" image="http://edu-image.nosdn.127.net/f07f5cb8e4e94ea4be7d845ead5f29d8.jpg?imageView&quality=100 .dark"><span class="background dark" style="background-image:url('http://edu-image.nosdn.127.net/f07f5cb8e4e94ea4be7d845ead5f29d8.jpg?imageView&quality=100')"></span><div class=wrap wrap=true><h1 class="text-landing text-shadow">降低重复性工作</h1><p class="text-intro animated fadeInUp delay-500">好好度个假</p><p><a href="https://omnipotent-front-end.github.io/shares/docs/nodeTools/slide.html#slide=1" class="button ghost animated flipInX delay-1200" target=_blank><i class="fa fa-github"></i> Github</a></p></div></section></article></div><script>window.pluginsOptions = {}



    window.webslidesOptions = {}


document.addEventListener('DOMContentLoaded', () => {
    let isPrintMode = false;
    if(~location.search.indexOf('print-pdf')){
        isPrintMode = true;
        WebSlides.registerPlugin('scroll', function(){});
    }
    const wsOptions = {
        loop: false
    };
    if(window.webslidesOptions){
        for (let i in webslidesOptions){
            if(webslidesOptions.hasOwnProperty(i)){
                wsOptions[i] = webslidesOptions[i];
            }
        }
    }
    const ws = new WebSlides(wsOptions)

    window.wsInstance = ws;
    if(isPrintMode){
        ws.slides.forEach(s=>s.show())
    }
}, false)</script><script src=./js/chunk-vendors.js></script><script src=./js/slide.js></script></body></html>